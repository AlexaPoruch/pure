<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:pure="http://beebole.com/pure">
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
		<title>Example 4 - Pure Unobtrusive Rendering Engine for HTML</title>
	    <link href="white.css" rel="alternate stylesheet" type="text/css" title="white"/>
	    <link href="black.css" rel="stylesheet" type="text/css" title="black"/>
		<script type="text/javascript" src="../js/jqueryMin.js"></script>
		<script type="text/javascript" src="../js/pure.js"></script>
		<script type="text/javascript" src="tutorial.js"></script>
		<script type="text/javascript">
			function transform(){
				var context = {'list':
					[["Alice Keasler", 14],
					["Charles LeGrand", 13],
					["Gary Bitemning",   20],
					["Helen Moren", 5],
					["Mary Cain",       15],
					["Vicky Benoit", 5],
					["Wayne Dartt", 11]]};
	
				var directive = {
					'tbody tr':  'player <- list',
					'td.player': 'player[0]',
					'td.score':  'player[1]',
					'tbody tr[class]' : (function(context, items, pos) { return ( pos % 2 == 0 ) ? 'even' : 'odd'; })}

				var html = document.getElementById('teamList');
				html = $p.map( directive, html);
				var target = document.getElementById('target');
				$p.render(html, context, target);
			}
			function libraryTransform(){
				$('#target').html( 
					$('#teamList')
					.$pMap({
						'tbody tr':  'player <- list',
						'td.player': 'player[0]',
						'td.score':  'player[1]',
						'tbody tr[class]' : (function(context, items, pos) { return ( pos % 2 == 1 ) ? 'even' : 'odd'; })})
						
					.$pRender({'list':
						[["Alice Keasler", 14],
						["Charles LeGrand", 13],
						["Gary Bitemning",   20],
						["Helen Moren", 5],
						["Mary Cain",       15],
						["Vicky Benoit", 5],
						["Wayne Dartt", 11]]}))}
		</script>
	</head>
	<body onload="transform()">
 		<div class="links"><a href="#" onclick="setActiveStyleSheet('black');return false;">Dark Night</a><span style="color:#52ABFF"> | </span><a href="#" onclick="setActiveStyleSheet('white');return false;">Bright Day</a>
				<br /><a href="quickStart.html">Quick Start</a><br />
				<a href="example1.html">Example 1</a><br />
				<a href="example2.html">Example 2</a><br />
				<a href="example3.html">Example 3</a><br />
				<a href="example4.html">Example 4</a><br />
				<a href="allExamples.html">All Examples</a><br />
				<a href="allExamplesCompiled.html">All Examples Compiled</a><br />
			<a href="http://groups.google.com/group/Pure-Unobtrusive-Rendering-Engine/post">Post</a> or <a href="mailto:Pure-Unobtrusive-Rendering-Engine@googlegroups.com">mail us</a><br /> your feedback
		</div>
		<h1>Example 4: A list of players and their score (zebra like)</h1>
		In <a href="example2.html">example 2</a> we generated a table with players and score.<br />
		Now what we want is to have a style for each other row of our table, to achieve this so sought after zebra effect.<br/>
		We will do that by passing a function as a directive, providing a flexible way to act on the rendering.</p>
		<p class="note">If Javascript, JSON and CSS selectors are your daily food, you may want to jump directly to the <a href="allExamples.html" target="_blank">All examples page</a>.<br />
		Fire your JS debugger. Put a breakpoint and watch it running.</p>

		<h2>The HTML</h2>
		We do not change our HTML and CSS. This is rather important to note.<br />
<pre>&lt;table id="teamList"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
	  &lt;th class="player"&gt;Player&lt;/th&gt;
	  &lt;th class="score"&gt;Score&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
	  &lt;td class="player"&gt;Chloe&lt;/td&gt;
	  &lt;td class="score"&gt;25&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</pre>
		Which should look like this in your web browser:
		<table id="teamList">
			<thead><tr><th class="player">Player</th><th class="score">Score</th></tr></thead>
			<tbody><tr><td class="player">Chloe</td><td class="score">25</td></tr></tbody>
		</table>
		We select the HTML by its Id.<br />
		<pre>var html = document.getElementById( 'teamList' );</pre>


		<h2>The Context</h2>
		The JSON data remains the same.
		<pre>var context = {'list':
	[["Alice Keasler", 34],
	["Charles LeGrand", 13],
	["Gary Bitemning", 50],
	["Helen Moren", 5],
	["Mary Cain", 15],
	["Vicky Benoit", 5],
	["Wayne Dartt", 11]]};</pre>


		<h2>A special directive</h2>
		Here is the trick! We will now set a new directives to the existing ones and this time it will be a Javascript function.
		<p>It is a classical javascript function( ){ } syntax, but placed between ( ).<br />
		That makes a self-invoking anonymous function. If you want to know more about this, have a look a this great explanation of <a href="http://www.hunlock.com/blogs/Functional_Javascript">functional javascript</a></p>

		<pre>var directive = {
  'tbody tr':  'player &lt;- list',
  'td.player': 'player[0]',
  'td.score':  'player[1]',
  <span class="codeHi">'tbody tr[class]' : 
	(function(context, items, pos) { 
		return ( pos % 2 == 0 ) ? 'even' : 'odd'; 
	})</span>
};</pre>
		<p class="note">
		It means: Set the attribute "class" of the &lt;tbody&gt; &lt;tr&gt; found in my template to the returned value of this function.<br />
		And the function means: every time the current index of the repetition is even(modulo 2 is 0) return 'even'. And return 'odd' when the index is odd.<br />
		To achieve this rendering, we added to our CSS two classes 'even' and 'odd', that will be applied to each line of our table.</p>
		<p class="note">To date, 3 arguments are available to this function when it is called within the template<br />
		- The context: which is the full set of data we pass to the template<br />
		- items: the items of the current iteration (if we are in a repetition)<br />
		- pos: the position, the index where we are in the current iteration (if we are in a repetition)</p>
		
		Then we map the directive to the HTML.
		<pre>html = $p.map( directive, html );</pre>


		<h2>Rendering</h2>
		In our page, we will now choose a site where we want to render our HTML.<br />
		Here the &lt;div&gt; with the id "target".
		<pre>&lt;div id="target"&gt;&lt;/div&gt;</pre>
		We select it in our javascript by its Id.
		<pre>var target = document.getElementById( 'target' );</pre>
		With the function $p.render( ) below, we apply the HTML to the context and place the result in the "target" element.
		<pre>$p.render( html, context, target )</pre>
		And you get this even more amazing result:
		<div id="target"><span class="oops">Oops! Either your javascript is disabled or something is broken...</span></div>

		<h2>Putting all the JS commands together</h2>
		This first set of instructions is javascript as usual.
		<pre>function transform(){
  var context = {'list':
    [["Alice Keasler", 14], 
    ["Charles LeGrand", 13],
    ["Gary Bitemning",   20],
    ["Helen Moren", 5],
    ["Mary Cain",       15],
    ["Vicky Benoit", 5],
    ["Wayne Dartt", 11]]};

  var directive = {
    'tbody tr':  'player &lt;- list',
    'td.player': 'player[0]',
    'td.score':  'player[1]',
    'tbody tr[class]' : (function(context, items, pos) { return ( pos % 2 == 1 ) ? 'even' : 'odd'; })})

  var html = document.getElementById('teamList');
  html = $p.map( directive, html);
  var target = document.getElementById('target');
  $p.render(html, context, target);
}</pre>
		And here again with a JS Library kind of syntax
		<pre>function libraryTransform(){
  $('#target').html( 
    $('#teamList')
    .$pMap({
      'tbody tr':  'player &lt;- list',
      'td.player': 'player[0]',
      'td.score':  'player[1]',
      'tbody tr[class]' : (function(context, items, pos) { return ( pos % 2 == 1 ) ? 'even' : 'odd'; })})
    .$pRender({'list':
      [["Alice Keasler", 14],
      ["Charles LeGrand", 13],
      ["Gary Bitemning",   20],
      ["Helen Moren", 5],
      ["Mary Cain",       15],
      ["Vicky Benoit", 5],
      ["Wayne Dartt", 11]]}))}</pre>
		<h2>Conclusion</h2>
		 That's it! We saw with this last example, that we can pass a function as a directive, to give us a flexible way of interracting with the template execution.<br />
		 If you arrived here, you can now jump to the <a href="allExamples.html">page with all examples</a><br />
		 There is still a last example about nested loops that was not explained, but you can see it working on that page.<br />
		 <span style="font-size:160%">Thank you very much</span> for your interest in PURE and feel free to leave us a comment either on the <a href="http://beebole.com/pure">blog</a> or on the <a href="http://groups.google.com/group/Pure-Unobtrusive-Rendering-Engine">discussion group</a>
	</body>
</html>